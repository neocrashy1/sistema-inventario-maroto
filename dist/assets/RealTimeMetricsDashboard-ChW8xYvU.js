import{r as a,c as e,w as t,o as s,a as l,e as i,k as r,f as u,B as n,y as o,D as c,I as d,z as v,x as m,m as p,an as h,F as f,C as b,g}from"./vue-vendor-BY5hdAT7.js";import{_ as y,k,l as _}from"./index-Dur0lEaU.js";import{C as w,a as C,L as x,P as M,b as A,p as D,c as I,d as R,i as P,e as T}from"./ui-vendor-2nBQeod0.js";import"./utils-vendor-COuxBHZ0.js";const z={class:"real-time-chart"},S={class:"chart-header"},q={class:"chart-title"},F={class:"chart-controls"},U=["title"],$={class:"chart-container"},N={class:"chart-stats"},L={class:"stat-item"},j={class:"stat-item"},E={class:"stat-value"},B={class:"stat-item"},W={class:"stat-value"},H={class:"stat-item"},O={class:"stat-value"},Q=y({__name:"RealTimeChart",props:{title:{type:String,required:!0},data:{type:Array,default:()=>[]},unit:{type:String,default:"%"},color:{type:String,default:"#3b82f6"},maxDataPoints:{type:Number,default:50},warningThreshold:{type:Number,default:70},criticalThreshold:{type:Number,default:90},updateInterval:{type:Number,default:5e3}},emits:["update-data"],setup(m,{expose:p,emit:h}){w.register(C,x,M,A,D,I,R,P);const f=m,b=h,g=a(null),y=a(0),k=a(!1),_=a([]),Q=a([]),V=a(null),Z=e(()=>_.value.length>0?_.value[_.value.length-1]:0),G=e(()=>{if(0===_.value.length)return 0;return _.value.reduce((a,e)=>a+e,0)/_.value.length}),J=e(()=>_.value.length>0?Math.max(..._.value):0),K=e(()=>_.value.length>0?Math.min(..._.value):0),X=e(()=>({labels:Q.value,datasets:[{label:f.title,data:_.value,borderColor:f.color,backgroundColor:`${f.color}20`,fill:!0,tension:.4,pointRadius:2,pointHoverRadius:4,borderWidth:2}]})),Y=e(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:f.color,borderWidth:1,callbacks:{label:a=>`${f.title}: ${aa(a.parsed.y)}${f.unit}`}}},scales:{x:{display:!0,grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"#6b7280",maxTicksLimit:10}},y:{display:!0,beginAtZero:!0,max:"%"===f.unit?100:void 0,grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{color:"#6b7280",callback:a=>`${aa(a)}${f.unit}`}}},animation:{duration:750,easing:"easeInOutQuart"}})),aa=a=>"number"!=typeof a?"0":a.toFixed(1),ea=a=>{if(k.value)return;const e=(new Date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});_.value.push(a),Q.value.push(e),_.value.length>f.maxDataPoints&&(_.value.shift(),Q.value.shift()),y.value++},ta=()=>{k.value=!k.value,k.value?clearInterval(V.value):la()},sa=()=>{_.value=[],Q.value=[],y.value++},la=()=>{V.value&&clearInterval(V.value),V.value=setInterval(()=>{k.value||b("update-data")},f.updateInterval)};return t(()=>f.data,a=>{if(a&&a.length>0){const e=a[a.length-1];ea(e)}},{deep:!0}),s(()=>{la(),f.data&&f.data.length>0&&f.data.forEach(a=>ea(a))}),l(()=>{V.value&&clearInterval(V.value)}),p({addDataPoint:ea,clearData:sa,togglePause:ta}),(a,e)=>{return r(),i("div",z,[u("div",S,[u("h3",q,n(m.title),1),u("div",F,[u("button",{onClick:ta,class:o(["btn","btn-sm",k.value?"btn-success":"btn-warning"]),title:k.value?"Retomar atualizações":"Pausar atualizações"},[u("i",{class:o(k.value?"fas fa-play":"fas fa-pause")},null,2),c(" "+n(k.value?"Retomar":"Pausar"),1)],10,U),u("button",{onClick:sa,class:"btn btn-sm btn-outline-secondary",title:"Limpar dados do gráfico"},[...e[0]||(e[0]=[u("i",{class:"fas fa-trash"},null,-1),c(" Limpar ",-1)])])])]),u("div",$,[(r(),d(v(T),{data:X.value,options:Y.value,key:y.value,ref_key:"chartRef",ref:g},null,8,["data","options"]))]),u("div",N,[u("div",L,[e[1]||(e[1]=u("span",{class:"stat-label"},"Atual:",-1)),u("span",{class:o(["stat-value",(t=Z.value,t>=f.criticalThreshold?"text-danger":t>=f.warningThreshold?"text-warning":"text-success")])},n(aa(Z.value))+n(m.unit),3)]),u("div",j,[e[2]||(e[2]=u("span",{class:"stat-label"},"Média:",-1)),u("span",E,n(aa(G.value))+n(m.unit),1)]),u("div",B,[e[3]||(e[3]=u("span",{class:"stat-label"},"Máximo:",-1)),u("span",W,n(aa(J.value))+n(m.unit),1)]),u("div",H,[e[4]||(e[4]=u("span",{class:"stat-label"},"Mínimo:",-1)),u("span",O,n(aa(K.value))+n(m.unit),1)])])]);var t}}},[["__scopeId","data-v-23302ae7"]]),V={class:"real-time-metrics-dashboard"},Z={class:"dashboard-header"},G={class:"dashboard-controls"},J={class:"machine-selector"},K=["value"],X={class:"refresh-controls"},Y=["title"],aa=["disabled"],ea={key:0,class:"no-machine-selected"},ta={key:1,class:"loading-state"},sa={key:2,class:"charts-grid"},la={class:"chart-card"},ia={class:"chart-card"},ra={class:"chart-card"},ua={class:"chart-card"},na={key:3,class:"machine-status"},oa={class:"status-header"},ca={class:"status-grid"},da={class:"status-item"},va={class:"status-info"},ma={class:"status-value"},pa={class:"status-item"},ha={class:"status-info"},fa={class:"status-value"},ba={class:"status-item"},ga={class:"status-info"},ya={class:"status-value"},ka={class:"status-item"},_a={class:"status-info"},wa={class:"status-value"},Ca=y({__name:"RealTimeMetricsDashboard",setup(e){const d=a(""),v=a([]),y=a(!1),w=a(!0),C=a(null),x=a(null),M=a(!1),A=a([]),D=a([]),I=a([]),R=a([]),P=a(null),T=a(null),z=a(null),S=a(null),q=async()=>{var a;try{const e=await k.getMachines(),t=Array.isArray(null==(a=e.data)?void 0:a.machines)?e.data.machines:Array.isArray(e.data)?e.data:[];v.value=t.map(a=>({id:a.id??a.machine_id??a.uuid??a._id??a.identifier??a.name,hostname:a.hostname??a.name??a.machine_id??`machine-${a.id??a.machine_id??Math.random().toString(36).slice(2,8)}`,ip_address:a.ip_address??a.ip??a.last_known_ip??a.address??"0.0.0.0"}))}catch(e){_.error("Erro ao carregar máquinas:",e)}},F=async a=>{var e;if(a)try{y.value=!0;const t=await k.getMetrics(a);(null==(e=t.data)?void 0:e.detail)?(_.warn("Backend não retornou métricas válidas:",t.data.detail),x.value=Da(),M.value=!1):(x.value=t.data,M.value=!0),U()}catch(t){_.error("Erro ao carregar métricas:",t),x.value=Da(),M.value=!1}finally{y.value=!1}},U=()=>{var a,e,t,s,l;if(!x.value)return;const i=x.value;if(void 0!==(null==(a=i.cpu)?void 0:a.usage_percent)&&(A.value=[...A.value,i.cpu.usage_percent]),void 0!==(null==(e=i.memory)?void 0:e.usage_percent)&&(D.value=[...D.value,i.memory.usage_percent]),(null==(t=i.disk)?void 0:t.disks)&&Array.isArray(i.disk.disks)){const a=$();I.value=[...I.value,a]}if(void 0!==(null==(s=i.network)?void 0:s.total_bytes_sent)&&void 0!==(null==(l=i.network)?void 0:l.total_bytes_recv)){const a=N();R.value=[...R.value,a]}},$=()=>{var a,e;if(!(null==(e=null==(a=x.value)?void 0:a.disk)?void 0:e.disks))return 0;const t=x.value.disk.disks;if(0===t.length)return 0;return(t.reduce((a,e)=>a+(e.usage_percent||0),0)/t.length).toFixed(1)},N=()=>{var a;if(!(null==(a=x.value)?void 0:a.network))return 0;return(((x.value.network.total_bytes_sent||0)+(x.value.network.total_bytes_recv||0))/1024/1024*8).toFixed(1)},L=()=>{var a,e;if(!x.value)return"Desconhecido";const t=(null==(a=x.value.cpu)?void 0:a.usage_percent)||0,s=(null==(e=x.value.memory)?void 0:e.usage_percent)||0,l=parseFloat($()),i=Math.max(t,s,l);return i>=95?"Crítico":i>=80?"Atenção":i>=60?"Normal":"Ótimo"},j=()=>{switch(L()){case"Crítico":return"status-critical";case"Atenção":return"status-warning";case"Normal":return"status-normal";case"Ótimo":return"status-good";default:return"status-unknown"}},E=()=>{A.value=[],D.value=[],I.value=[],R.value=[],x.value=null,M.value=!1,d.value?(F(d.value),H()):O()},B=()=>{d.value&&F(d.value)},W=()=>{w.value=!w.value,w.value?H():O()},H=()=>{O(),d.value&&(C.value=setInterval(()=>{w.value&&F(d.value)},5e3))},O=()=>{C.value&&(clearInterval(C.value),C.value=null)},Ca=()=>{d.value&&w.value&&F(d.value)},xa=()=>{d.value&&w.value&&F(d.value)},Ma=()=>{d.value&&w.value&&F(d.value)},Aa=()=>{d.value&&w.value&&F(d.value)};s(()=>{q()}),l(()=>{O()}),t(d,a=>{a?H():O()});const Da=()=>({cpu:{usage_percent:0},memory:{usage_percent:0},disk:{disks:[]},network:{total_bytes_sent:0,total_bytes_recv:0}});return(a,e)=>{var t,s,l,k;return r(),i("div",V,[u("div",Z,[e[4]||(e[4]=u("h2",{class:"dashboard-title"},[u("i",{class:"fas fa-chart-line"}),c(" Métricas em Tempo Real ")],-1)),u("div",G,[u("div",J,[e[2]||(e[2]=u("label",{for:"machine-select"},"Máquina:",-1)),p(u("select",{id:"machine-select","onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),onChange:E,class:"form-select"},[e[1]||(e[1]=u("option",{value:""},"Selecione uma máquina",-1)),(r(!0),i(f,null,b(v.value,a=>(r(),i("option",{key:a.id,value:a.id},n(a.hostname)+" ("+n(a.ip_address)+") ",9,K))),128))],544),[[h,d.value]])]),u("div",X,[u("button",{onClick:W,class:o(["btn",w.value?"btn-success":"btn-outline-secondary"]),title:w.value?"Desativar atualização automática":"Ativar atualização automática"},[u("i",{class:o(w.value?"fas fa-pause":"fas fa-play")},null,2),c(" "+n(w.value?"Pausar":"Iniciar"),1)],10,Y),u("button",{onClick:B,class:"btn btn-primary",disabled:y.value,title:"Atualizar dados manualmente"},[u("i",{class:o(["fas",y.value?"fa-spinner fa-spin":"fa-sync-alt"])},null,2),e[3]||(e[3]=c(" Atualizar ",-1))],8,aa)])])]),d.value?y.value&&!M.value?(r(),i("div",ta,[...e[6]||(e[6]=[u("div",{class:"spinner-container"},[u("div",{class:"spinner"}),u("p",null,"Carregando métricas...")],-1)])])):(r(),i("div",sa,[u("div",la,[g(Q,{ref_key:"cpuChart",ref:P,title:"CPU (%)",data:A.value,unit:"%",color:"#ef4444","warning-threshold":70,"critical-threshold":90,onUpdateData:Ca},null,8,["data"])]),u("div",ia,[g(Q,{ref_key:"memoryChart",ref:T,title:"Memória (%)",data:D.value,unit:"%",color:"#3b82f6","warning-threshold":80,"critical-threshold":95,onUpdateData:xa},null,8,["data"])]),u("div",ra,[g(Q,{ref_key:"diskChart",ref:z,title:"Disco (%)",data:I.value,unit:"%",color:"#f59e0b","warning-threshold":85,"critical-threshold":95,onUpdateData:Ma},null,8,["data"])]),u("div",ua,[g(Q,{ref_key:"networkChart",ref:S,title:"Rede (Mbps)",data:R.value,unit:" Mbps",color:"#10b981","warning-threshold":80,"critical-threshold":95,onUpdateData:Aa},null,8,["data"])])])):(r(),i("div",ea,[...e[5]||(e[5]=[u("div",{class:"empty-state"},[u("i",{class:"fas fa-desktop fa-3x"}),u("h3",null,"Selecione uma máquina"),u("p",null,"Escolha uma máquina na lista acima para visualizar as métricas em tempo real.")],-1)])])),d.value&&x.value?(r(),i("div",na,[u("div",oa,[e[7]||(e[7]=u("h3",null,"Status da Máquina",-1)),u("span",{class:o(["status-badge",j()])},n(L()),3)]),u("div",ca,[u("div",da,[e[9]||(e[9]=u("div",{class:"status-icon cpu"},[u("i",{class:"fas fa-microchip"})],-1)),u("div",va,[e[8]||(e[8]=u("span",{class:"status-label"},"CPU",-1)),u("span",ma,n((null==(s=null==(t=x.value.cpu)?void 0:t.usage_percent)?void 0:s.toFixed(1))||0)+"%",1)])]),u("div",pa,[e[11]||(e[11]=u("div",{class:"status-icon memory"},[u("i",{class:"fas fa-memory"})],-1)),u("div",ha,[e[10]||(e[10]=u("span",{class:"status-label"},"Memória",-1)),u("span",fa,n((null==(k=null==(l=x.value.memory)?void 0:l.usage_percent)?void 0:k.toFixed(1))||0)+"%",1)])]),u("div",ba,[e[13]||(e[13]=u("div",{class:"status-icon disk"},[u("i",{class:"fas fa-hdd"})],-1)),u("div",ga,[e[12]||(e[12]=u("span",{class:"status-label"},"Disco",-1)),u("span",ya,n($())+"%",1)])]),u("div",ka,[e[15]||(e[15]=u("div",{class:"status-icon network"},[u("i",{class:"fas fa-network-wired"})],-1)),u("div",_a,[e[14]||(e[14]=u("span",{class:"status-label"},"Rede",-1)),u("span",wa,n(N())+" Mbps",1)])])])])):m("",!0)])}}},[["__scopeId","data-v-77492f52"]]);export{Ca as default};
//# sourceMappingURL=RealTimeMetricsDashboard-ChW8xYvU.js.map
