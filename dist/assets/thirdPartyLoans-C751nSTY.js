import{l as e}from"./index-Dur0lEaU.js";import{b as t,r as a,c as o}from"./vue-vendor-BY5hdAT7.js";const r=t("thirdPartyLoans",()=>{const t=a([{id:1,code:"TER001",thirdParty:{id:1,name:"TechSolutions Ltda",type:"Empresa",document:"12.345.678/0001-90",contactName:"Roberto Mendes",contactEmail:"roberto@techsolutions.com",contactPhone:"(11) 98765-4321",address:"Rua das Flores, 123 - São Paulo/SP"},asset:{id:1,name:"Projetor Epson PowerLite",code:"PROJ001",category:"Audiovisual",serialNumber:"EP789123456"},loanDate:"2024-01-10",expectedReturnDate:"2024-01-20",returnDate:"2024-01-18",status:"Devolvido",purpose:"Apresentação de projeto para cliente",notes:"Empréstimo para evento corporativo",condition:"Perfeito",returnNotes:"Devolvido em perfeitas condições após evento",createdAt:"2024-01-10T09:00:00Z",updatedAt:"2024-01-18T17:30:00Z"},{id:2,code:"TER002",thirdParty:{id:2,name:"João Carlos Silva",type:"Pessoa Física",document:"123.456.789-00",contactName:"João Carlos Silva",contactEmail:"joao.carlos@email.com",contactPhone:"(11) 99876-5432",address:"Av. Paulista, 456 - São Paulo/SP"},asset:{id:2,name:"Notebook Dell Latitude 5520",code:"NB001",category:"Informática",serialNumber:"DL123456789"},loanDate:"2024-01-15",expectedReturnDate:"2024-02-15",returnDate:null,status:"Ativo",purpose:"Trabalho freelance de desenvolvimento",notes:"Empréstimo para projeto de 30 dias",condition:null,returnNotes:null,createdAt:"2024-01-15T14:00:00Z",updatedAt:"2024-01-15T14:00:00Z"},{id:3,code:"TER003",thirdParty:{id:3,name:"Consultoria ABC",type:"Prestador de Serviço",document:"98.765.432/0001-10",contactName:"Maria Fernanda",contactEmail:"maria@consultoriaabc.com",contactPhone:"(11) 97654-3210",address:"Rua Augusta, 789 - São Paulo/SP"},asset:{id:3,name:"Tablet iPad Pro",code:"TAB001",category:"Informática",serialNumber:"IP456789123"},loanDate:"2024-01-05",expectedReturnDate:"2024-01-12",returnDate:null,status:"Em Atraso",purpose:"Auditoria de processos",notes:"Empréstimo para consultoria externa",condition:null,returnNotes:null,createdAt:"2024-01-05T10:30:00Z",updatedAt:"2024-01-05T10:30:00Z"},{id:4,code:"TER004",thirdParty:{id:4,name:"EventPro Produções",type:"Empresa",document:"11.222.333/0001-44",contactName:"Carlos Eduardo",contactEmail:"carlos@eventpro.com",contactPhone:"(11) 96543-2109",address:"Rua dos Eventos, 321 - São Paulo/SP"},asset:{id:4,name:"Câmera Canon EOS R6",code:"CAM001",category:"Audiovisual",serialNumber:"CN987654321"},loanDate:"2024-01-20",expectedReturnDate:"2024-01-25",returnDate:null,status:"Ativo",purpose:"Cobertura fotográfica de evento corporativo",notes:"Empréstimo para evento de lançamento",condition:null,returnNotes:null,createdAt:"2024-01-20T11:15:00Z",updatedAt:"2024-01-20T11:15:00Z"}]),r=a([{id:1,name:"Projetor Epson PowerLite",code:"PROJ001",category:"Audiovisual",status:"Disponível"},{id:2,name:"Notebook Dell Latitude 5520",code:"NB001",category:"Informática",status:"Emprestado"},{id:3,name:"Tablet iPad Pro",code:"TAB001",category:"Informática",status:"Emprestado"},{id:4,name:"Câmera Canon EOS R6",code:"CAM001",category:"Audiovisual",status:"Emprestado"},{id:5,name:"Monitor LG UltraWide",code:"MON001",category:"Informática",status:"Disponível"},{id:6,name:"Impressora HP LaserJet",code:"IMP001",category:"Informática",status:"Disponível"},{id:7,name:"Smartphone Samsung Galaxy",code:"CEL001",category:"Comunicação",status:"Disponível"},{id:8,name:"Microfone Shure SM58",code:"MIC001",category:"Audiovisual",status:"Disponível"},{id:9,name:"Switch Cisco 24 portas",code:"SW001",category:"Rede",status:"Disponível"}]),n=a(!1),s=a(null),i=o(()=>t.value.length),u=o(()=>t.value.filter(e=>"Ativo"===e.status)),d=o(()=>{const e=new Date;return t.value.filter(t=>{if("Ativo"!==t.status)return!1;return new Date(t.expectedReturnDate)<e})}),l=o(()=>t.value.filter(e=>"Devolvido"===e.status)),c=o(()=>{const e={};return t.value.forEach(t=>{const a=t.thirdParty.type;e[a]||(e[a]=0),e[a]++}),e}),v=o(()=>{const e={};return t.value.forEach(t=>{e[t.status]||(e[t.status]=0),e[t.status]++}),e}),m=o(()=>t.value.filter(e=>"Ativo"===e.status).map(e=>e.asset.id)),p=o(()=>r.value.filter(e=>"Disponível"===e.status&&!m.value.includes(e.id))),D=o(()=>{const e={};return t.value.forEach(t=>{const a=new Date(t.loanDate).toISOString().slice(0,7);e[a]||(e[a]=0),e[a]++}),e}),w=(e,a)=>e||a?t.value.filter(t=>{const o=new Date(t.loanDate),r=e?new Date(e):new Date("1900-01-01"),n=a?new Date(a):new Date("2100-12-31");return o>=r&&o<=n}):t.value,y=e=>[["Código","Terceiro","Tipo","Documento","Contato","Email","Telefone","Ativo","Código Ativo","Data Empréstimo","Data Prevista","Data Devolução","Status","Finalidade","Condição","Observações"],...e.map(e=>[e.code,e.thirdParty.name,e.thirdParty.type,e.thirdParty.document,e.thirdParty.contactName,e.thirdParty.contactEmail,e.thirdParty.contactPhone,e.asset.name,e.asset.code,e.loanDate,e.expectedReturnDate,e.returnDate||"",e.status,e.purpose,e.condition||"",e.notes])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),h=(e,t,a)=>{const o=new Blob([e],{type:a}),r=window.URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)};return{loans:t,availableAssets:r,loading:n,error:s,totalLoans:i,activeLoans:u,overdueLoans:d,returnedLoans:l,loansByType:c,loansByStatus:v,assetsOnLoan:m,availableAssetsForLoan:p,loansByMonth:D,fetchLoans:async()=>{n.value=!0,s.value=null;try{await new Promise(e=>setTimeout(e,1e3)),n.value=!1}catch(e){throw s.value=e.message,n.value=!1,e}},createLoan:async e=>{n.value=!0,s.value=null;try{const a=r.value.find(t=>t.id===e.assetId);if(!a)throw new Error("Ativo não encontrado");if("Disponível"!==a.status)throw new Error("Ativo não está disponível para empréstimo");const o=new Date(e.loanDate);if(new Date(e.expectedReturnDate)<=o)throw new Error("A data prevista de devolução deve ser posterior à data do empréstimo");if(!e.thirdPartyName||!e.contactName||!e.contactEmail)throw new Error("Todos os campos obrigatórios devem ser preenchidos");await new Promise(e=>setTimeout(e,500));const s={id:Date.now(),name:e.thirdPartyName,type:e.thirdPartyType,document:e.thirdPartyDocument||"",contactName:e.contactName,contactEmail:e.contactEmail,contactPhone:e.contactPhone||"",address:""},i={id:Date.now()+1,code:`TER${String(t.value.length+1).padStart(3,"0")}`,thirdParty:s,asset:a,loanDate:e.loanDate,expectedReturnDate:e.expectedReturnDate,returnDate:null,status:"Ativo",purpose:e.purpose||"",notes:e.notes||"",condition:null,returnNotes:null,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};t.value.push(i);const u=r.value.findIndex(t=>t.id===e.assetId);return-1!==u&&(r.value[u].status="Emprestado"),n.value=!1,i}catch(a){throw s.value=a.message,n.value=!1,a}},returnLoan:async(e,a)=>{n.value=!0,s.value=null;try{await new Promise(e=>setTimeout(e,500));const o=t.value.findIndex(t=>t.id===e);if(-1===o)throw new Error("Empréstimo não encontrado");const s=t.value[o];if("Ativo"!==s.status&&"Em Atraso"!==s.status)throw new Error("Este empréstimo não está ativo");const i=new Date(a.returnDate);if(i<new Date(s.loanDate))throw new Error("A data de devolução não pode ser anterior à data do empréstimo");t.value[o]={...s,returnDate:a.returnDate,status:"Devolvido",condition:a.condition,returnNotes:a.returnNotes||"",updatedAt:(new Date).toISOString()};const u=r.value.findIndex(e=>e.id===s.asset.id);return-1!==u&&(r.value[u].status="Disponível"),n.value=!1,t.value[o]}catch(o){throw s.value=o.message,n.value=!1,o}},updateLoan:async(e,a)=>{n.value=!0,s.value=null;try{await new Promise(e=>setTimeout(e,500));const o=t.value.findIndex(t=>t.id===e);if(-1===o)throw new Error("Empréstimo não encontrado");return t.value[o]={...t.value[o],...a,updatedAt:(new Date).toISOString()},n.value=!1,t.value[o]}catch(o){throw s.value=o.message,n.value=!1,o}},cancelLoan:async(e,a)=>{n.value=!0,s.value=null;try{await new Promise(e=>setTimeout(e,500));const o=t.value.findIndex(t=>t.id===e);if(-1===o)throw new Error("Empréstimo não encontrado");const s=t.value[o];if("Ativo"!==s.status&&"Em Atraso"!==s.status)throw new Error("Apenas empréstimos ativos podem ser cancelados");t.value[o]={...s,status:"Cancelado",returnNotes:a,updatedAt:(new Date).toISOString()};const i=r.value.findIndex(e=>e.id===s.asset.id);return-1!==i&&(r.value[i].status="Disponível"),n.value=!1,t.value[o]}catch(o){throw s.value=o.message,n.value=!1,o}},getLoanById:e=>t.value.find(t=>t.id===e),getLoansByThirdParty:e=>t.value.filter(t=>t.thirdParty.id===e),getLoansByAsset:e=>t.value.filter(t=>t.asset.id===e),searchLoans:e=>{if(!e)return t.value;const a=e.toLowerCase();return t.value.filter(e=>e.code.toLowerCase().includes(a)||e.thirdParty.name.toLowerCase().includes(a)||e.thirdParty.contactName.toLowerCase().includes(a)||e.thirdParty.contactEmail.toLowerCase().includes(a)||e.asset.name.toLowerCase().includes(a)||e.asset.code.toLowerCase().includes(a)||e.purpose.toLowerCase().includes(a)||e.notes.toLowerCase().includes(a))},filterLoansByStatus:e=>e?t.value.filter(t=>t.status===e):t.value,filterLoansByType:e=>e?t.value.filter(t=>t.thirdParty.type===e):t.value,filterLoansByDateRange:w,getOverdueLoans:()=>{const e=new Date;return t.value.filter(t=>{if("Ativo"!==t.status)return!1;return new Date(t.expectedReturnDate)<e})},updateOverdueStatus:()=>{const e=new Date;t.value.forEach(t=>{if("Ativo"===t.status){new Date(t.expectedReturnDate)<e&&(t.status="Em Atraso",t.updatedAt=(new Date).toISOString())}})},getThirdPartyHistory:e=>t.value.filter(t=>t.thirdParty.id===e).sort((e,t)=>new Date(t.loanDate)-new Date(e.loanDate)),getAssetHistory:e=>t.value.filter(t=>t.asset.id===e).sort((e,t)=>new Date(t.loanDate)-new Date(e.loanDate)),getTopThirdParties:(e=5)=>{const a={};return t.value.forEach(e=>{const t=e.thirdParty.id;a[t]||(a[t]={thirdParty:e.thirdParty,count:0}),a[t].count++}),Object.values(a).sort((e,t)=>t.count-e.count).slice(0,e)},exportLoans:async(a="csv",o={})=>{try{n.value=!0;let r=t.value;if(o.status&&(r=r.filter(e=>e.status===o.status)),o.type&&(r=r.filter(e=>e.thirdParty.type===o.type)),(o.startDate||o.endDate)&&(r=w(o.startDate,o.endDate)),await new Promise(e=>setTimeout(e,1e3)),"csv"===a){const e=y(r);h(e,"emprestimos-terceiros.csv","text/csv")}else"excel"===a&&e.debug("Exportação para Excel não implementada ainda");return n.value=!1,!0}catch(r){throw s.value=r.message,n.value=!1,r}},clearError:()=>{s.value=null}}});export{r as u};
//# sourceMappingURL=thirdPartyLoans-C751nSTY.js.map
