import{b as t}from"./vue-vendor-BY5hdAT7.js";import{h as e,b as a}from"./index-Dur0lEaU.js";const s=t("physicalInventory",{state:()=>({inventories:[{id:1,code:"INV-2024-001",description:"Inventário Anual - Sede Principal",location:{id:1,name:"Sede Principal",code:"SEDE"},responsible:{id:1,name:"João Silva",email:"joao.silva@empresa.com"},startDate:"2024-01-15",endDate:"2024-01-30",status:"completed",totalAssets:150,countedAssets:150,discrepancies:3,progress:100,createdAt:"2024-01-10T08:00:00Z",updatedAt:"2024-01-30T17:30:00Z",notes:"Inventário concluído com sucesso. Pequenas discrepâncias identificadas e corrigidas.",assets:[{id:1,assetCode:"NB-001",assetName:"Notebook Dell Latitude",expectedLocation:"Sala 101",actualLocation:"Sala 101",status:"found",condition:"good",notes:"Ativo encontrado em bom estado"},{id:2,assetCode:"MON-015",assetName:'Monitor Samsung 24"',expectedLocation:"Sala 102",actualLocation:"Sala 103",status:"moved",condition:"good",notes:"Ativo encontrado em localização diferente"}]},{id:2,code:"INV-2024-002",description:"Inventário Trimestral - Filial Norte",location:{id:2,name:"Filial Norte",code:"FIL-N"},responsible:{id:2,name:"Maria Santos",email:"maria.santos@empresa.com"},startDate:"2024-02-01",endDate:"2024-02-15",status:"in_progress",totalAssets:85,countedAssets:62,discrepancies:1,progress:73,createdAt:"2024-01-25T09:00:00Z",updatedAt:"2024-02-10T14:20:00Z",notes:"Inventário em andamento. Progresso dentro do cronograma.",assets:[{id:3,assetCode:"CPU-025",assetName:"Desktop HP ProDesk",expectedLocation:"Sala 201",actualLocation:"Sala 201",status:"found",condition:"good",notes:"Ativo encontrado conforme esperado"}]},{id:3,code:"INV-2024-003",description:"Inventário Especial - Equipamentos TI",location:{id:4,name:"Data Center",code:"DC"},responsible:{id:3,name:"Carlos Oliveira",email:"carlos.oliveira@empresa.com"},startDate:"2024-03-01",endDate:"2024-03-10",status:"planned",totalAssets:45,countedAssets:0,discrepancies:0,progress:0,createdAt:"2024-02-20T10:00:00Z",updatedAt:"2024-02-20T10:00:00Z",notes:"Inventário planejado para equipamentos críticos do data center.",assets:[]}],locations:[{id:1,name:"Sede Principal",code:"SEDE"},{id:2,name:"Filial Norte",code:"FIL-N"},{id:3,name:"Filial Sul",code:"FIL-S"},{id:4,name:"Data Center",code:"DC"},{id:5,name:"Almoxarifado",code:"ALM"}],responsibles:[{id:1,name:"João Silva",department:"TI"},{id:2,name:"Maria Santos",department:"Administração"},{id:3,name:"Carlos Oliveira",department:"TI"},{id:4,name:"Ana Costa",department:"Patrimônio"}],availableAssets:[{id:1,tag:"LVT-001",name:"Notebook Dell Latitude 5520",brand:"Dell",model:"Latitude 5520",serialNumber:"DL5520-2023-001",category:"Informática",subcategory:"Notebooks",status:"Ativo",location:"TI - Sala 101",department:"Tecnologia da Informação",value:3500,acquisitionDate:"2023-01-15",entryDate:"2023-01-20",warranty:{startDate:"2023-01-15",endDate:"2025-01-15",provider:"Dell Brasil",type:"Garantia do Fabricante",status:"Ativa"},responsible:"João Silva",condition:"Novo",lastInventoryDate:"2023-12-01",inventoryStatus:"Contado",specifications:{processor:"Intel Core i7-1165G7",memory:"16GB DDR4",storage:"512GB SSD",screen:'15.6" Full HD'}},{id:2,tag:"LVT-002",name:'Monitor LG 24"',brand:"LG",model:"24MK430H-B",serialNumber:"LG24-2023-002",category:"Informática",subcategory:"Monitores",status:"Ativo",location:"TI - Sala 101",department:"Tecnologia da Informação",value:800,acquisitionDate:"2023-02-10",entryDate:"2023-02-12",warranty:{startDate:"2023-02-10",endDate:"2026-02-10",provider:"LG Electronics",type:"Garantia Estendida",status:"Ativa"},responsible:"Maria Santos",condition:"Novo",lastInventoryDate:"2023-12-01",inventoryStatus:"Contado",specifications:{size:"24 polegadas",resolution:"1920x1080",panel:"IPS",connectivity:"HDMI, VGA"}},{id:3,tag:"LVT-003",name:"Impressora HP LaserJet Pro M404dn",brand:"HP",model:"LaserJet Pro M404dn",serialNumber:"HP404-2022-003",category:"Equipamentos",subcategory:"Impressoras",status:"Manutenção",location:"Administrativo",department:"Administrativo",value:1200,acquisitionDate:"2022-08-20",entryDate:"2022-08-25",warranty:{startDate:"2022-08-20",endDate:"2024-08-20",provider:"HP Brasil",type:"Garantia do Fabricante",status:"Expirada"},responsible:"Carlos Oliveira",condition:"Usado",lastInventoryDate:"2023-11-15",inventoryStatus:"Discrepância",specifications:{type:"Laser Monocromática",speed:"38 ppm",resolution:"1200 x 1200 dpi",connectivity:"Ethernet, USB"}},{id:4,tag:"LVT-004",name:"Smartphone Samsung Galaxy A54",brand:"Samsung",model:"Galaxy A54 5G",serialNumber:"SM-A546B-2023-004",category:"Telefonia",subcategory:"Smartphones",status:"Ativo",location:"Vendas - Sala 201",department:"Comercial",value:1800,acquisitionDate:"2023-06-15",entryDate:"2023-06-18",warranty:{startDate:"2023-06-15",endDate:"2024-06-15",provider:"Samsung Brasil",type:"Garantia do Fabricante",status:"Ativa"},responsible:"Ana Costa",condition:"Novo",lastInventoryDate:null,inventoryStatus:"Não Contado",specifications:{storage:"256GB",memory:"8GB RAM",screen:'6.4" Super AMOLED',camera:"50MP + 12MP + 5MP"}},{id:5,tag:"LVT-005",name:"Mesa de Escritório Executive",brand:"Móveis Office",model:"Executive 160x80",serialNumber:"MO-EX-160-005",category:"Mobiliário",subcategory:"Mesas",status:"Ativo",location:"Diretoria - Sala 301",department:"Diretoria",value:2500,acquisitionDate:"2023-03-10",entryDate:"2023-03-15",warranty:{startDate:"2023-03-10",endDate:"2028-03-10",provider:"Móveis Office Ltda",type:"Garantia do Fabricante",status:"Ativa"},responsible:"Roberto Silva",condition:"Novo",lastInventoryDate:"2023-12-01",inventoryStatus:"Contado",specifications:{material:"MDF com acabamento em laminado",dimensions:"160cm x 80cm x 75cm",color:"Mogno",drawers:"3 gavetas com fechadura"}}],loading:!1,error:null,searchTerm:"",filters:{status:"",location:"",responsible:"",dateRange:{start:"",end:""}}}),getters:{totalInventories:t=>t.inventories.length,inventoriesInProgress:t=>t.inventories.filter(t=>"in_progress"===t.status).length,totalAssetsCount:t=>t.inventories.reduce((t,e)=>t+e.countedAssets,0),totalDiscrepancies:t=>t.inventories.reduce((t,e)=>t+e.discrepancies,0),inventoriesByStatus:t=>t.inventories.reduce((t,e)=>(t[e.status]=(t[e.status]||0)+1,t),{}),inventoriesByLocation:t=>t.inventories.reduce((t,e)=>(t[e.location]=(t[e.location]||0)+1,t),{}),inventoriesByResponsible:t=>t.inventories.reduce((t,e)=>(t[e.responsible]=(t[e.responsible]||0)+1,t),{}),averageProgress:t=>{const e=t.inventories.filter(t=>"in_progress"===t.status||"completed"===t.status);if(0===e.length)return 0;const a=e.reduce((t,e)=>t+e.progress,0);return Math.round(a/e.length)},filteredInventories:t=>{let e=[...t.inventories];if(t.searchTerm){const a=t.searchTerm.toLowerCase();e=e.filter(t=>t.code.toLowerCase().includes(a)||t.description.toLowerCase().includes(a)||t.responsible.toLowerCase().includes(a)||t.location.toLowerCase().includes(a))}return t.filters.status&&(e=e.filter(e=>e.status===t.filters.status)),t.filters.location&&(e=e.filter(e=>e.location===t.filters.location)),t.filters.responsible&&(e=e.filter(e=>e.responsible===t.filters.responsible)),t.filters.dateRange.start&&t.filters.dateRange.end&&(e=e.filter(e=>{const a=new Date(e.startDate),s=new Date(t.filters.dateRange.start),o=new Date(t.filters.dateRange.end);return a>=s&&a<=o})),e},totalAvailableAssets:t=>t.availableAssets.length,assetsByInventoryStatus:t=>t.availableAssets.reduce((t,e)=>{const a=e.inventoryStatus||"Não Contado";return t[a]=(t[a]||0)+1,t},{}),assetsByWarrantyStatus:t=>{const e=new Date,a=new Date(e.getTime()+2592e6);return t.availableAssets.reduce((t,s)=>{if(!s.warranty)return t["Sem Garantia"]=(t["Sem Garantia"]||0)+1,t;const o=new Date(s.warranty.endDate);return o<e?t.Expirada=(t.Expirada||0)+1:o<=a?t.Expirando=(t.Expirando||0)+1:t.Ativa=(t.Ativa||0)+1,t},{})},assetsByCategory:t=>t.availableAssets.reduce((t,e)=>(t[e.category]=(t[e.category]||0)+1,t),{}),assetsByDepartment:t=>t.availableAssets.reduce((t,e)=>(t[e.department]=(t[e.department]||0)+1,t),{}),totalAssetsValue:t=>t.availableAssets.reduce((t,e)=>t+(e.value||0),0),expiredWarrantyAssets:t=>{const e=new Date;return t.availableAssets.filter(t=>{if(!t.warranty)return!1;return new Date(t.warranty.endDate)<e})},expiringWarrantyAssets:t=>{const e=new Date,a=new Date(e.getTime()+2592e6);return t.availableAssets.filter(t=>{if(!t.warranty)return!1;const s=new Date(t.warranty.endDate);return s>=e&&s<=a})},uncountedAssets:t=>t.availableAssets.filter(t=>!t.inventoryStatus||"Não Contado"===t.inventoryStatus),discrepancyAssets:t=>t.availableAssets.filter(t=>"Discrepância"===t.inventoryStatus),assetsByCondition:t=>t.availableAssets.reduce((t,e)=>{const a=e.condition||"Não Informado";return t[a]=(t[a]||0)+1,t},{})},actions:{async fetchInventories(){this.loading=!0,this.error=null;try{const{data:t}=await a.getAll({skip:0,limit:100}),e=Array.isArray(null==t?void 0:t.items)?t.items:Array.isArray(t)?t:[];this.inventories=e.map(t=>this.mapAuditoriaToInventory(t)),this.loading=!1}catch(t){const a=e(t);throw this.error=a.message||"Erro ao carregar inventários",this.loading=!1,t}},async startInventory(t){this.loading=!0,this.error=null;try{await a.start(t),await this.updateInventory(t,{status:"in_progress",startDate:(new Date).toISOString().split("T")[0]}),this.loading=!1}catch(s){const t=e(s);throw this.error=t.message||"Erro ao iniciar inventário",this.loading=!1,s}},async recordAssetCount(t,s){this.loading=!0,this.error=null;try{const e=Array.isArray(s)?s.map(t=>({item_id:t.itemId||t.id,codigo_lido:t.assetCode||t.codigo_lido||t.tag,local_encontrado_id:t.local_encontrado_id||t.actualLocationId||null,estado_encontrado:t.condition||t.estado_encontrado||null,observacoes:t.notes||t.observacoes||"",foto_url:t.foto_url||t.photoUrl||null})):[{item_id:s.itemId||s.id,codigo_lido:s.assetCode||s.codigo_lido||s.tag,local_encontrado_id:s.local_encontrado_id||s.actualLocationId||null,estado_encontrado:s.condition||s.estado_encontrado||null,observacoes:s.notes||s.observacoes||"",foto_url:s.foto_url||s.photoUrl||null}];await a.registerCollection(t,e);const o=this.inventories.find(e=>e.id===t);if(o){const t=t=>({id:t.item_id||t.id||Date.now(),assetCode:t.codigo_lido||t.assetCode||t.tag||"",assetName:t.assetName||t.descricao||"",expectedLocation:t.expectedLocation||"",actualLocation:t.actualLocation||"",status:this.mapCountStatusToAssetStatus(t.countStatus||"found"),condition:t.estado_encontrado||t.condition||"good",notes:t.observacoes||t.notes||""});(Array.isArray(s)?s.map(t):[t(s)]).forEach(t=>{const e=o.assets.findIndex(e=>e.assetCode===t.assetCode);-1!==e?o.assets[e]={...o.assets[e],...t}:o.assets.push({id:Date.now(),...t})}),o.countedAssets=o.assets.length,o.discrepancies=o.assets.filter(t=>"moved"===t.status||"missing"===t.status||"damaged"===t.status).length,o.progress=o.totalAssets>0?Math.round(o.countedAssets/o.totalAssets*100):0,o.updatedAt=(new Date).toISOString()}this.loading=!1}catch(o){const t=e(o);throw this.error=t.message||"Erro ao registrar contagem",this.loading=!1,o}},async getInventoryAssets(t){this.loading=!0,this.error=null;try{const{data:e}=await a.getCountList(t),s=(Array.isArray(null==e?void 0:e.itens)?e.itens:[]).map(t=>this.mapAPIItemToAsset(t));return this.loading=!1,s}catch(s){const t=e(s);throw this.error=t.message||"Erro ao buscar ativos para inventário",this.loading=!1,s}},mapAuditoriaToInventory(t){const e=t.total_itens??t.total_itens_esperados??0,a=(t.itens_conformes||0)+(t.itens_divergentes||0)+(t.itens_nao_encontrados||0)+(t.itens_extras||0),s=e>0?Math.round(a/e*100):0;return{id:t.id,code:t.nome||`AUD-${t.id}`,description:t.descricao||"",location:t.escopo_locais||"",responsible:"",startDate:t.data_inicio?String(t.data_inicio).split("T")[0]:"",endDate:t.data_fim?String(t.data_fim).split("T")[0]:"",status:{PLANEJADA:"planned",EM_ANDAMENTO:"in_progress",RECONCILIACAO:"in_progress",FINALIZADA:"completed",CANCELADA:"cancelled"}[t.status]||t.status||"planned",totalAssets:e,countedAssets:a,discrepancies:(t.itens_divergentes||0)+(t.itens_nao_encontrados||0)+(t.itens_extras||0),progress:s,createdAt:t.criado_em||"",updatedAt:t.atualizado_em||"",notes:t.observacoes_finais||"",assets:[]}},mapAPIItemToAsset(t){return{id:t.id||t.item_id||Date.now(),assetCode:t.codigo||t.patrimonio||t.tag||"",assetName:t.descricao||t.nome||"",expectedLocation:t.local_esperado||t.local_esperado_nome||"",actualLocation:t.local_encontrado||t.local_encontrado_nome||t.expectedLocation||"",status:this.mapCountStatusToAssetStatus(t.countStatus||("conforme"===t.resultado?"found":"not_counted")),condition:t.estado_encontrado||"good",notes:t.observacoes||""}}},async updateInventory(t,e){this.loading=!0,this.error=null;try{await new Promise(t=>setTimeout(t,500));const a=this.inventories.findIndex(e=>e.id===t);-1!==a&&(this.inventories[a]={...this.inventories[a],...e,updatedAt:(new Date).toISOString()}),this.loading=!1}catch(a){throw this.error="Erro ao atualizar inventário",this.loading=!1,a}},mapCountStatusToAssetStatus:t=>({found:"found",not_found:"missing",damaged:"damaged",wrong_location:"moved",not_counted:"pending"}[t]||"pending"),async createInventory(t){this.loading=!0,this.error=null;try{await new Promise(t=>setTimeout(t,500));const e={id:Date.now(),code:`INV-${(new Date).getFullYear()}-${String(this.inventories.length+1).padStart(3,"0")}`,...t,status:"planned",totalAssets:0,countedAssets:0,discrepancies:0,progress:0,assets:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return this.inventories.unshift(e),this.loading=!1,e}catch(e){throw this.error="Erro ao criar inventário",this.loading=!1,e}},async completeInventory(t){await this.updateInventory(t,{status:"completed",endDate:(new Date).toISOString().split("T")[0],progress:100})},async cancelInventory(t){await this.updateInventory(t,{status:"cancelled"})},async updateInventoryCounting(t,e){this.loading=!0,this.error=null;try{await new Promise(t=>setTimeout(t,500));const a=this.inventories.find(e=>e.id===t);a&&(a.assets=e.map(t=>({id:t.id,assetCode:t.tag,assetName:t.name,expectedLocation:t.location,actualLocation:t.actualLocation||t.location,status:this.mapCountStatusToAssetStatus(t.countStatus),condition:t.condition||"good",notes:t.countNotes||"",counted:t.counted||!1,hasDiscrepancy:t.hasDiscrepancy||!1})),a.countedAssets=e.filter(t=>t.counted).length,a.discrepancies=e.filter(t=>t.hasDiscrepancy).length,a.totalAssets=e.length,a.progress=a.totalAssets>0?Math.round(a.countedAssets/a.totalAssets*100):0,100===a.progress?(a.status="completed",a.endDate=(new Date).toISOString().split("T")[0]):a.progress>0&&"planned"===a.status&&(a.status="in_progress"),a.updatedAt=(new Date).toISOString()),this.loading=!1}catch(a){throw this.error="Erro ao atualizar contagem do inventário",this.loading=!1,a}},async reconcileScans(t){if(!Array.isArray(t)||0===t.length)return{processed:0,failed:0};this.loading=!0,this.error=null;const a=t.reduce((t,e)=>{const a=e.inventoryId;return a?(t[a]||(t[a]=[]),t[a].push(e),t):t},{});let s=0,o=0;for(const[i,r]of Object.entries(a)){const t=r.map(t=>({itemId:t.assetId||t.itemId||null,assetCode:t.code||t.assetCode||"",condition:t.condition||"good",notes:(t.notes||"")+(t.notes?" ":"")+"[Reconciliação Offline]",countStatus:t.status||"found"}));if(t.length)try{await this.recordAssetCount(parseInt(i,10),t),s+=r.length}catch(n){o+=r.length;const t=e?e(n):null;this.error=t&&t.message||"Erro ao reconciliar leituras offline"}}return this.loading=!1,{processed:s,failed:o}},clearError(){this.error=null},async deleteInventory(t){this.loading=!0,this.error=null;try{await new Promise(t=>setTimeout(t,500));const e=this.inventories.findIndex(e=>e.id===t);-1!==e&&this.inventories.splice(e,1),this.loading=!1}catch(e){throw this.error="Erro ao deletar inventário",this.loading=!1,e}},setSearchTerm(t){this.searchTerm=t},setFilters(t){this.filters={...this.filters,...t}},clearFilters(){this.filters={status:"",location:"",responsible:"",dateRange:{start:"",end:""}},this.searchTerm=""},async exportInventories(t="csv"){try{const e=this.filteredInventories;if("csv"===t){const t=this.generateCSV(e);this.downloadFile(t,`inventarios_${(new Date).toISOString().split("T")[0]}.csv`,"text/csv")}return!0}catch(e){throw this.error="Erro ao exportar dados",e}},generateCSV(t){return[["Código","Descrição","Localização","Responsável","Status","Data Início","Data Fim","Total Ativos","Ativos Contados","Discrepâncias","Progresso (%)","Observações"],...t.map(t=>[t.code,t.description,t.location,t.responsible,this.getStatusLabel(t.status),t.startDate,t.endDate||"",t.totalAssets,t.countedAssets,t.discrepancies,t.progress,t.notes||""])].map(t=>t.map(t=>`"${t}"`).join(",")).join("\n")},downloadFile(t,e,a){const s=new Blob([t],{type:a}),o=window.URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)},getStatusLabel:t=>({planned:"Planejado",in_progress:"Em Andamento",completed:"Concluído",cancelled:"Cancelado"}[t]||t),getStatusColor:t=>({planned:"blue",in_progress:"orange",completed:"green",cancelled:"red"}[t]||"gray")});export{s as u};
//# sourceMappingURL=physicalInventory-DJKBk5BT.js.map
