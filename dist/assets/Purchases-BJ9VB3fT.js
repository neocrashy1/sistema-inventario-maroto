import{b as e,a1 as t,H as a,c as s,e as r,k as l,f as o,B as n,z as i,u,m as c,K as d,an as h,r as p,o as m,x as v,I as f,a9 as b,F as y,C as g}from"./vue-vendor-BY5hdAT7.js";import{_ as w}from"./index-Dur0lEaU.js";import"./utils-vendor-COuxBHZ0.js";const P=new class{constructor(){this.purchases=[{id:1,code:"PR-2025-001",supplier:"Fornecedor A",items:[{description:"SSD 512GB",qty:2,unitPrice:350}],total:700,status:"quote",createdAt:(new Date).toISOString(),notes:"Orçamento inicial"}]}async list(e={}){return await new Promise(e=>setTimeout(e,300)),{data:this.purchases.slice()}}async get(e){await new Promise(e=>setTimeout(e,200));return{data:this.purchases.find(t=>t.id===Number(e))||null}}async create(e){await new Promise(e=>setTimeout(e,300));const t=Date.now(),a=(e.items||[]).reduce((e,t)=>e+(t.qty||0)*(t.unitPrice||0),0),s={id:t,code:`PR-${(new Date).getFullYear()}-${String(this.purchases.length+1).padStart(3,"0")}`,...e,total:a,createdAt:(new Date).toISOString()};return this.purchases.unshift(s),{data:s}}async update(e,t){await new Promise(e=>setTimeout(e,250));const a=this.purchases.findIndex(t=>t.id===Number(e));return-1===a?{data:null}:(this.purchases[a]={...this.purchases[a],...t},{data:this.purchases[a]})}async remove(e){await new Promise(e=>setTimeout(e,200));const t=this.purchases.findIndex(t=>t.id===Number(e));return-1!==t&&this.purchases.splice(t,1),{success:!0}}},C=e("purchases",{state:()=>({purchases:[],loading:!1,error:null,searchTerm:"",filters:{status:""}}),getters:{totalPurchases:e=>e.purchases.length,filteredPurchases:e=>{let t=[...e.purchases];if(e.searchTerm){const a=e.searchTerm.toLowerCase();t=t.filter(e=>e.code.toLowerCase().includes(a)||(e.supplier||"").toLowerCase().includes(a))}return e.filters.status&&(t=t.filter(t=>t.status===e.filters.status)),t}},actions:{async fetchPurchases(){this.loading=!0,this.error=null;try{const e=await P.list();this.purchases=e.data||[],this.loading=!1}catch(e){throw this.error="Erro ao buscar compras",this.loading=!1,e}},async createPurchase(e){this.loading=!0,this.error=null;try{const t=await P.create(e);return this.purchases.unshift(t.data),this.loading=!1,t.data}catch(t){throw this.error="Erro ao criar compra",this.loading=!1,t}},async updatePurchase(e,t){this.loading=!0,this.error=null;try{const a=await P.update(e,t),s=this.purchases.findIndex(e=>e.id===a.data.id);return-1!==s&&(this.purchases[s]=a.data),this.loading=!1,a.data}catch(a){throw this.error="Erro ao atualizar compra",this.loading=!1,a}},async deletePurchase(e){this.loading=!0,this.error=null;try{await P.remove(e);const t=this.purchases.findIndex(t=>t.id===Number(e));-1!==t&&this.purchases.splice(t,1),this.loading=!1}catch(t){throw this.error="Erro ao deletar compra",this.loading=!1,t}},setSearchTerm(e){this.searchTerm=e},setFilters(e){this.filters={...this.filters,...e}}}}),S={class:"purchase-form-overlay"},O={class:"purchase-form"},T={class:"field"},k={class:"field"},I={class:"field"},q={class:"actions"},V=w({__name:"PurchaseForm",props:{modelValue:{type:Object,default:null}},emits:["close","save"],setup(e,{emit:p}){const m=p,v=t({value:null}).value,f=a(modelValue?{...modelValue}:{supplier:"",items:[],status:"quote",notes:""}),b=s({get:()=>JSON.stringify(f.items||[],null,2),set(e){try{f.items=JSON.parse(e)}catch(t){}}}),y=()=>{f.total=(f.items||[]).reduce((e,t)=>e+(t.qty||0)*(t.unitPrice||0),0),m("save",f)};return(e,t)=>(l(),r("div",S,[o("div",O,[o("header",null,[o("h3",null,n(i(v).id?"Editar Orçamento":"Novo Orçamento"),1),o("button",{class:"close",onClick:t[0]||(t[0]=t=>e.$emit("close"))},"×")]),o("form",{onSubmit:u(y,["prevent"])},[o("div",T,[t[5]||(t[5]=o("label",null,"Fornecedor",-1)),c(o("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>f.supplier=e),required:""},null,512),[[d,f.supplier]])]),o("div",k,[t[6]||(t[6]=o("label",null,"Itens (JSON)",-1)),c(o("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>b.value=e),rows:"4"},null,512),[[d,b.value]]),t[7]||(t[7]=o("small",null,'Formato: [{"description":"Item A","qty":1,"unitPrice":10}]',-1))]),o("div",I,[t[9]||(t[9]=o("label",null,"Status",-1)),c(o("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>f.status=e)},[...t[8]||(t[8]=[o("option",{value:"quote"},"Orçamento",-1),o("option",{value:"ordered"},"Encomendado",-1),o("option",{value:"received"},"Recebido",-1),o("option",{value:"cancelled"},"Cancelado",-1)])],512),[[h,f.status]])]),o("div",q,[t[10]||(t[10]=o("button",{type:"submit",class:"btn btn-primary"},"Salvar",-1)),o("button",{type:"button",class:"btn",onClick:t[4]||(t[4]=t=>e.$emit("close"))},"Cancelar")])],32)])]))}},[["__scopeId","data-v-c7314f90"]]),x={class:"page purchases-page"},E={class:"filters"},F={key:0},N={key:1,class:"table"},_=["onClick"],R=["onClick"],D=w({__name:"Purchases",setup(e){const t=C(),a=s(()=>t.loading),i=p(!1),u=p(null),w=p(""),P=p("");m(()=>{t.fetchPurchases()});const S=()=>{u.value=null,i.value=!0},O=()=>{i.value=!1,u.value=null},T=async e=>{e.id?await t.updatePurchase(e.id,e):await t.createPurchase(e),O()},k=s(()=>{const e=w.value;return t.setSearchTerm(e),t.setFilters({status:P.value}),t.filteredPurchases});return(e,s)=>(l(),r("section",x,[o("header",{class:"page-header"},[s[2]||(s[2]=o("h1",null,"Compras & Orçamentos",-1)),o("div",{class:"actions"},[o("button",{onClick:S,class:"btn btn-primary"},"Novo Orçamento")])]),o("main",null,[o("div",E,[c(o("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),placeholder:"Buscar por código ou fornecedor"},null,512),[[d,w.value]]),c(o("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>P.value=e)},[...s[3]||(s[3]=[b('<option value="" data-v-11bce01f>Todos</option><option value="quote" data-v-11bce01f>Orçamento</option><option value="ordered" data-v-11bce01f>Encomendado</option><option value="received" data-v-11bce01f>Recebido</option><option value="cancelled" data-v-11bce01f>Cancelado</option>',5)])],512),[[h,P.value]])]),a.value?(l(),r("div",F,"Carregando...")):v("",!0),a.value?v("",!0):(l(),r("table",N,[s[4]||(s[4]=o("thead",null,[o("tr",null,[o("th",null,"Código"),o("th",null,"Fornecedor"),o("th",null,"Itens"),o("th",null,"Total"),o("th",null,"Status"),o("th",null,"Ações")])],-1)),o("tbody",null,[(l(!0),r(y,null,g(k.value,e=>{return l(),r("tr",{key:e.id},[o("td",null,n(e.code),1),o("td",null,n(e.supplier),1),o("td",null,n(e.items?e.items.length:0),1),o("td",null,n((s=e.total,null==s?"-":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}))),1),o("td",null,n((a=e.status,{quote:"Orçamento",ordered:"Encomendado",received:"Recebido",cancelled:"Cancelado"}[a]||a)),1),o("td",null,[o("button",{onClick:t=>(e=>{u.value={...e},i.value=!0})(e),class:"btn btn-sm"},"Editar",8,_),o("button",{onClick:a=>(async e=>{confirm("Confirma a exclusão deste orçamento?")&&await t.deletePurchase(e)})(e.id),class:"btn btn-sm btn-danger"},"Deletar",8,R)])]);var a,s}),128))])])),i.value?(l(),f(V,{key:2,modelValue:u.value,onClose:O,onSave:T},null,8,["modelValue"])):v("",!0)])]))}},[["__scopeId","data-v-11bce01f"]]);export{D as default};
//# sourceMappingURL=Purchases-BJ9VB3fT.js.map
